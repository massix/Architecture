# Makefile to build Receptor and Frontend libraries and binaries

include ../Makefile.inc

CXXFLAGS += -I../include -I../protobuf -I/usr/local/include/google
LDFLAGS = $(ZMQ_LDFLAGS) $(MESSAGES_LDFLAGS) $(BOOST_LDFLAGS) $(PBUF_LDFLAGS)

LIBRECEPTOR_SRC = Receptor.cpp
LIBFRONTEND_SRC = FrontendItf.cpp MessageQueue.cpp

LIBRECEPTOR_OBJ = $(LIBRECEPTOR_SRC:.cpp=.o)
LIBFRONTEND_OBJ = $(LIBFRONTEND_SRC:.cpp=.o)

LIBRECEPTOR_TARGET = libreceptor${LIB_EXT}
LIBFRONTEND_TARGET = libfrontend${LIB_EXT}

RECEPTOR_OBJS = REmain.o
FRONTEND_OBJS = FEmain.o

RECEPTOR_TARGET = receptor
FRONTEND_TARGET = frontend

all: $(LIBRECEPTOR_TARGET) $(LIBFRONTEND_TARGET) $(RECEPTOR_TARGET) $(FRONTEND_TARGET)

.PHONY: clean install

$(LIBRECEPTOR_TARGET): $(LIBRECEPTOR_OBJ)
	$(CXX) $(LDFLAGS) $(LIBRECEPTOR_OBJ) -shared -o $(LIBRECEPTOR_TARGET)

$(LIBFRONTEND_TARGET): $(LIBFRONTEND_OBJ)
	$(CXX) $(LDFLAGS) $(LIBFRONTEND_OBJ) -shared -o $(LIBFRONTEND_TARGET)

$(RECEPTOR_TARGET): $(LIBRECEPTOR_TARGET) $(RECEPTOR_OBJS)
	$(CXX) $(CXXFLAGS) $(LDFLAGS) -L. -lreceptor $(RECEPTOR_OBJS) -o $(RECEPTOR_TARGET)

$(FRONTEND_TARGET): $(LIBFRONTEND_TARGET) $(FRONTEND_OBJS)
	$(CXX) $(CXXFLAGS) $(LDFLAGS) -L. -lfrontend $(FRONTEND_OBJS) -o $(FRONTEND_TARGET)

install: $(RECEPTOR_TARGET) $(FRONTEND_TARGET)
	@echo "Installing in ${INSTALL_DIR}"
	@mkdir -p ${INSTALL_DIR}
	cp $(LIBRECEPTOR_TARGET) \
		$(LIBFRONTEND_TARGET) \
		$(RECEPTOR_TARGET) \
		$(FRONTEND_TARGET) \
		${INSTALL_DIR}

clean:
	rm -f $(RECEPTOR_TARGET) $(FRONTEND_TARGET)
	rm -f $(LIBRECEPTOR_TARGET) $(LIBFRONTEND_TARGET)
	rm -f $(LIBRECEPTOR_OBJ) $(LIBFRONTEND_OBJ)
